!function(){"use strict";var e,o;!function(e,o){void 0===o&&(o={});var i=o.insertAt;if(e&&"undefined"!=typeof document){var t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===i&&t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}}(".rm-block-ref span.bp3-icon-video {\n  display: inline-flex;\n}\n"),e="video",o=({ctx:e,name:o})=>{const i=(new Map).set(/https\:\/\/www\.bilibili\.com\/video\/([^(\s\)\})]*)/,((e,o)=>`https://player.bilibili.com/player.html?bvid=${o}&page=1&high_quality=1&as_wide=1&allowfullscreen=true`)).set(/https\:\/\/www\.ixigua\.com\/([^(\s\)\})]*)/,((e,o)=>`https://www.ixigua.com/iframe/${o}?autoplay=0&amp;startTime=0`)).set(/https\:\/\/v\.youku\.com\/v_show\/id_([^(\s\)\})]*)\.html/,((e,o)=>`https://player.youku.com/embed/${o}`)).set(/https\:\/\/v\.qq\.com\/x\/page\/([^(\s\)\})]*).html/,((e,o)=>`https://v.qq.com/txp/iframe/player.html?vid=${o}`));function t(e){const o=[...i.keys()].find((o=>o.test(e)));if(o){const t=e.match(o);return[i.get(o)(...t),o]}return[]}async function n(e){const o=e.closest("div.rm-block__input").id,i=window.roamEnhance.utils.getBlockUidFromId(o);return(await window.roam42.common.getBlockInfoByUID(i))[0][0]}e.resetVideoBlock=async function(e){var o;const i=null===(o=[...e.closest("div.rm-block__input").querySelectorAll(".bp3-icon-reset")])||void 0===o?void 0:o.indexOf(e),{string:t,uid:l}=await n(e);let a=0;const c=t.replace(/\{\{videoo\:\s*(.*?)\}\}/g,((e,o)=>{const t=i===a?o:e;return a++,t}));e.closest("div.rm-block__input").querySelectorAll(".bp3-icon-video").forEach((e=>e.remove())),await window.roam42.common.updateBlock(l,c)},e.focusBlock=e=>{window.roam42.common.simulateMouseClick(e.closest("div.rm-block__input"))},document.arrive(".roam-app div.rm-block__input button",{existing:!0},(async function(e){var i,l;if("videoo"===e.innerText){const a=null===(i=[...e.closest("div.rm-block__input").querySelectorAll("button")])||void 0===i?void 0:i.filter((e=>"videoo"===e.innerText)).indexOf(e),{string:c}=await n(e),r=null===(l=c.match(/\{\{videoo\:\s*(.*?)\}\}/g))||void 0===l?void 0:l[a];if(r){const[i]=t(r);e.outerHTML=`<div class="rm-iframe__spacing-wrapper rm-video-player__spacing-wrapper"><div class="rm-iframe__container rm-video-player__container hoverparent"><div class="hoveronly"><button onclick="window.roamEnhance._plugins['${o}'].focusBlock(this)" class="bp3-button bp3-small bp3-icon-standard bp3-icon-edit bp3-minimal rm-iframe__edit-btn rm-video-player__edit-btn" content=""></button><button onclick="window.roamEnhance._plugins['${o}'].resetVideoBlock(this);" style="position: absolute; right: 25px; top: 0; z-index: 10;" class="bp3-button bp3-small bp3-icon-standard bp3-icon-reset bp3-minimal rm-iframe__edit-btn rm-video-player__edit-btn" content=""></button></div><iframe class="rm-video-player" style="width: 100%; height: 100%; pointer-events: auto;" src="${i}" frameborder="no" allowfullscreen="" sandbox="allow-top-navigation-by-user-activation allow-same-origin allow-forms allow-scripts allow-popups"></iframe></div></div>`}}})),document.arrive(".roam-app div.rm-block__input a",{existing:!0},(async function(e){if(e.href){const[o,i]=t(e.href);if(i){const o=document.createElement("template");o.innerHTML='<span class="bp3-button bp3-minimal bp3-icon-video bp3-small dont-focus-block" tabindex="0"></span>',o.content.firstChild.onclick=async function(e){var o;const t=e.target,l=null===(o=[...t.closest("div.rm-block__input").querySelectorAll(".bp3-icon-video")])||void 0===o?void 0:o.indexOf(t),{string:a,uid:c}=await n(t),r=new RegExp(`(?<!(\\{\\{videoo\\:\\s*))\\[([^(\\[\\])]*?)\\]\\((${i.toString().slice(1,-1)})\\)`,"g");let s=0,d=a.replace(r,(e=>l===s++?`{{videoo: ${e}}}`:e));d!==a?(t.closest("div.rm-block__input").querySelectorAll(".bp3-icon-video").forEach((e=>e.remove())),window.roam42.common.updateBlock(c,d)):(s=0,d=a.replace(new RegExp(`(?<!(\\{\\{videoo\\:\\s*))(${i.toString().slice(1,-1)})`,"g"),(e=>l===s++?`{{videoo: ${e}}}`:e)),d!==a&&(t.closest("div.rm-block__input").querySelectorAll(".bp3-icon-video").forEach((e=>e.remove())),window.roam42.common.updateBlock(c,d)))},e.before(o.content.firstChild)}}}))},window.roamEnhance._plugins[e]={},window.roamEnhance.loaded.add(e),function(e,o=""){let i=0;!async function e(t){var n;try{await t()}catch(t){console.log("[name] error",t),i<5&&setTimeout((()=>e(++i)),2e3),i>5&&(null===(n=window.roam42)||void 0===n||n.help.displayMessage(`${o}加载失败`,2e3))}}(e)}((async()=>{await o({ctx:window.roamEnhance._plugins[e],name:e})}),e),"1=[xxx](https://www.bilibili.com/video/BV1oX4y137Eq) =\n2= https://www.bilibili.com/video/BV1Cz4y117rB =".match(/(\[(?:[^(\[\])]*)\]\(https\:\/\/www\.bilibili\.com\/video\/([^(\s\)\})]*)\))|(https\:\/\/www\.bilibili\.com\/video\/([^(\s\)\})]*))/g)}();
