!function(){"use strict";function e(e,o=""){let i=0;function t(e){var n;try{e()}catch(e){console.log("error",e),i<5&&setTimeout((()=>t(++i)),3e3),i>5&&(null===(n=window.roam42)||void 0===n||n.help.displayMessage(`${o}加载失败`,2e3))}}setTimeout((()=>t(e)),3e3)}var o,i;!function(e,o){void 0===o&&(o={});var i=o.insertAt;if(e&&"undefined"!=typeof document){var t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===i&&t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}}(".rm-block-ref span.bp3-icon-video {\n  display: inline-flex;\n}\n"),o="video",i=()=>{const e=(new Map).set(/https\:\/\/www\.bilibili\.com\/video\/([^(\s\)\})]*)/,((e,o)=>`https://player.bilibili.com/player.html?bvid=${o}&page=1&high_quality=1&as_wide=1&allowfullscreen=true`)).set(/https\:\/\/www\.ixigua\.com\/([^(\s\)\})]*)/,((e,o)=>`https://www.ixigua.com/iframe/${o}?autoplay=0&amp;startTime=0`)).set(/https\:\/\/v\.youku\.com\/v_show\/id_([^(\s\)\})]*)\.html/,((e,o)=>`https://player.youku.com/embed/${o}`)).set(/https\:\/\/v\.qq\.com\/x\/page\/([^(\s\)\})]*).html/,((e,o)=>`https://v.qq.com/txp/iframe/player.html?vid=${o}`));function o(o){const i=[...e.keys()].find((e=>e.test(o)));if(i){const t=o.match(i);return[e.get(i)(...t),i]}return[]}async function i(e){const o=e.closest("div.rm-block__input").id,i=window.roamEnhance.utils.getBlockUidFromId(o);return(await window.roam42.common.getBlockInfoByUID(i))[0][0]}window.roamEnhance.__resetVideoBlock=async function(e){var o;const t=null===(o=[...e.closest("div.rm-block__input").querySelectorAll(".bp3-icon-reset")])||void 0===o?void 0:o.indexOf(e),{string:n,uid:l}=await i(e);let c=0;const r=n.replace(/\{\{videoo\:\s*(.*?)\}\}/g,((e,o)=>{const i=t===c?o:e;return c++,i}));e.closest("div.rm-block__input").querySelectorAll(".bp3-icon-video").forEach((e=>e.remove())),await window.roam42.common.updateBlock(l,r)},window.roamEnhance.__focusBlock=e=>{window.roam42.common.simulateMouseClick(e.closest("div.rm-block__input"))},document.arrive(".roam-app div.rm-block__input button",{existing:!0},(async function(e){var t,n;if("videoo"===e.innerText){const l=null===(t=[...e.closest("div.rm-block__input").querySelectorAll("button")])||void 0===t?void 0:t.filter((e=>"videoo"===e.innerText)).indexOf(e),{string:c}=await i(e),r=null===(n=c.match(/\{\{videoo\:\s*(.*?)\}\}/g))||void 0===n?void 0:n[l];if(r){const[i]=o(r);e.outerHTML=`<div class="rm-iframe__spacing-wrapper rm-video-player__spacing-wrapper"><div class="rm-iframe__container rm-video-player__container hoverparent"><div class="hoveronly"><button onclick="window.roamEnhance.__focusBlock(this)" class="bp3-button bp3-small bp3-icon-standard bp3-icon-edit bp3-minimal rm-iframe__edit-btn rm-video-player__edit-btn" content=""></button><button onclick="window.roamEnhance.__resetVideoBlock(this);" style="position: absolute; right: 25px; top: 0; z-index: 10;" class="bp3-button bp3-small bp3-icon-standard bp3-icon-reset bp3-minimal rm-iframe__edit-btn rm-video-player__edit-btn" content=""></button></div><iframe class="rm-video-player" style="width: 100%; height: 100%; pointer-events: auto;" src="${i}" frameborder="no" allowfullscreen="" sandbox="allow-top-navigation-by-user-activation allow-same-origin allow-forms allow-scripts allow-popups"></iframe></div></div>`}}})),document.arrive(".roam-app div.rm-block__input a",{existing:!0},(async function(e){if(e.href){const[t,n]=o(e.href);if(n){const o=document.createElement("template");o.innerHTML='<span class="bp3-button bp3-minimal bp3-icon-video bp3-small dont-focus-block" tabindex="0"></span>',o.content.firstChild.onclick=async function(e){var o;const t=e.target,l=null===(o=[...t.closest("div.rm-block__input").querySelectorAll(".bp3-icon-video")])||void 0===o?void 0:o.indexOf(t),{string:c,uid:r}=await i(t),a=new RegExp(`(?<!(\\{\\{videoo\\:\\s*))\\[([^(\\[\\])]*?)\\]\\((${n.toString().slice(1,-1)})\\)`,"g");let s=0,d=c.replace(a,(e=>l===s++?`{{videoo: ${e}}}`:e));d!==c?(t.closest("div.rm-block__input").querySelectorAll(".bp3-icon-video").forEach((e=>e.remove())),window.roam42.common.updateBlock(r,d)):(s=0,d=c.replace(new RegExp(`(?<!(\\{\\{videoo\\:\\s*))(${n.toString().slice(1,-1)})`,"g"),(e=>l===s++?`{{videoo: ${e}}}`:e)),d!==c&&(t.closest("div.rm-block__input").querySelectorAll(".bp3-icon-video").forEach((e=>e.remove())),window.roam42.common.updateBlock(r,d)))},e.before(o.content.firstChild)}}}))},window.roamEnhance.loaded.add(o),e(i,o),"1=[xxx](https://www.bilibili.com/video/BV1oX4y137Eq) =\n2= https://www.bilibili.com/video/BV1Cz4y117rB =".match(/(\[(?:[^(\[\])]*)\]\(https\:\/\/www\.bilibili\.com\/video\/([^(\s\)\})]*)\))|(https\:\/\/www\.bilibili\.com\/video\/([^(\s\)\})]*))/g)}();
